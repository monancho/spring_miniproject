<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="com.monancho.board.dao.BoardDao">
    	
   	<!-- board : member 1 : 1 관계 -->
    	<resultMap type="com.monancho.board.dto.BoardDto" id="boardWithMember">
    			<id property="bnum" column="bnum"/>
    			<result property="btitle" column="btitle"/>
    			<result property="bcontent" column="bcontent"/>
    			<result property="bwriter" column="bwriter"/>
    			<result property="bhit" column="bhit"/>  			
    			<result property="bdate" column="bdate"/>  		
    			<result property="rnum" column="rnum"/>  		
    				
   			<association property="memberDto" javaType="com.monancho.board.dto.MemberDto">
   				<id property="memberid" column="memberid"/>
   				<result property="membernum" column="membernum"/>
   				<result property="memberpw" column="memberpw"/>
   				<result property="membername" column="membername"/>
   				<result property="memberdate" column="memberdate"/>
   			</association>
    	</resultMap>
    	
    	<select id="BBSselectList" resultMap="boardWithMember">
    		<![CDATA[
		    	SELECT * 
				FROM (
				    SELECT ROWNUM AS rnum, r.*
				    FROM(
				        SELECT b.bnum, b.btitle, b.bcontent, b.bwriter, m.membername, b.bhit, b.bdate
				        FROM boardtbl b
				        INNER JOIN membertbl m ON b.bwriter = m.memberid
                        WHERE ${type} Like '%'||#{keyword}||'%' AND bdate <= SYSDATE+1
				        ORDER BY b.bnum DESC)
				    r WHERE ROWNUM <= #{endRow})
				WHERE rnum >= #{startRow}
			]]>
    	</select>
    	<select id="BBScount" resultType="int" >
    		<![CDATA[
	    		SELECT COUNT(*)
	        	FROM boardtbl
		        
	            WHERE ${type} LIKE '%'||#{keyword}||'%' AND bdate <= SYSDATE+1
     	   ]]>
    	</select>
    	<select id="BBSselectBybnum" resultType="com.monancho.board.dto.BoardDto">
    		SELECT *
    		FROM boardtbl
    		WHERE bnum = #{param1}
    	</select>
    	
    	<update id="BBSbhit" >
    		UPDATE boardtbl SET bhit = bhit + 1 WHERE bnum = #{param1}
    	</update>
    	
    	<update id="BBSupdate" parameterType="com.monancho.board.dto.BoardDto">
    		UPDATE boardtbl 
    		SET btitle = #{btitle}, bcontent = #{bcontent}
    		WHERE bnum = #{bnum}
    	</update>
    	
    	<delete id="BBSdelete">
    		DELETE FROM boardtbl WHERE bnum = #{param1}
    	</delete>
    	
    	<insert id="BBSinsert" parameterType="com.monancho.board.dto.BoardDto">
    		INSERT INTO boardtbl (bnum ,btitle, bcontent, bwriter, bhit)
    		VALUES(board_seq.nextval, #{btitle}, #{bcontent}, #{bwriter}, 0)
    	</insert>
    	
    	<insert id="RSVNinsert" parameterType="com.monancho.board.dto.BoardDto">
    		INSERT INTO boardtbl (bnum ,btitle, bcontent, bwriter, bdate, bhit)
    		VALUES(board_seq.nextval, #{btitle}, #{bcontent}, #{bwriter}, #{bdate}, 0)
    	</insert>
    	
    	<select id="RSVNselectList" resultMap="boardWithMember">
    		<![CDATA[
		    	SELECT * 
				FROM (
				    SELECT ROWNUM AS rnum, r.*
				    FROM(
				        SELECT b.bnum, b.btitle, b.bcontent, b.bwriter, m.membername, b.bhit, b.bdate
				        FROM boardtbl b
				        INNER JOIN membertbl m ON b.bwriter = m.memberid
                        WHERE bdate > SYSDATE+1 AND b.bwriter = #{sid}
				        ORDER BY b.bnum DESC)
				    r WHERE ROWNUM <= #{endRow})
				WHERE rnum >= #{startRow}
			]]>
    	</select>
    	<select id="RSVNcount" resultType="int" >
    		<![CDATA[
	    		SELECT COUNT(*)
	        	FROM boardtbl
	            WHERE bdate > SYSDATE+1 AND bwriter = #{param1}
     	   ]]>
    	</select>
    	
    	<insert id="CMTinsert" parameterType="com.monancho.board.dto.CommentDto">
    		INSERT INTO commenttbl (cnum ,bnum ,memberid, ccontent)
    		VALUES(comment_seq.nextval, #{bnum}, #{memberid}, #{ccontent})
    	</insert>
    	
    	<select id="CMTselectList" resultType="com.monancho.board.dto.CommentDto">
    		SELECT *
    		FROM commenttbl
    		WHERE bnum = #{param1}
    	</select>
    	
    	<delete id="CMTdelete">
    		DELETE FROM commenttbl WHERE cnum = #{param1}
    	</delete>
    </mapper>